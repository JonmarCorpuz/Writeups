
# Enumeration With PowerView

Powerview is a powerful powershell script from powershell empire that can be used for enumerating a domain after you have already gained a shell in the system.

```Bash
┌──(kali㉿kali)-[~]
└─$ ssh Administrator@10.10.32.47           
The authenticity of host '10.10.32.47 (10.10.32.47)' can't be established.
ED25519 key fingerprint is SHA256:WGyVsv2zGcSJEHIwp99EmFf5p6Q49BhKyHfmoVOGCAg.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.32.47' (ED25519) to the list of known hosts.
Administrator@10.10.32.47's password:

Microsoft Windows [Version 10.0.17763.737]
(c) 2018 Microsoft Corporation. All rights reserved.

controller\administrator@DOMAIN-CONTROLL C:\Users\Administrator>
```

```Bash
controller\administrator@DOMAIN-CONTROLL C:\Users\Administrator>PowerShell.exe -ep Bypass
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Users\Administrator>  
```

```PowerShell
PS C:\Users\Administrator> . .\Downloads\PowerView.ps1 
```

[PowerView Enumeration Commands](https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993)

```PowerShell
PS C:\Users\Administrator> Invoke-ShareFinder
\\Domain-Controller.CONTROLLER.local\ADMIN$     - Remote Admin 
\\Domain-Controller.CONTROLLER.local\C$         - Default share
\\Domain-Controller.CONTROLLER.local\IPC$       - Remote IPC
\\Domain-Controller.CONTROLLER.local\NETLOGON   - Logon server share
\\Domain-Controller.CONTROLLER.local\Share      -
\\Domain-Controller.CONTROLLER.local\SYSVOL     - Logon server share
```

```PowerShell
PS C:\Users\Administrator> Get-NetComputer -fulldata | select operatingsystem

operatingsystem                  
---------------
Windows Server 2019 Standard
Windows 10 Enterprise Evaluation
Windows 10 Enterprise Evaluation
```

```PowerShell
PS C:\Users\Administrator> Get-NetUser | Select cn

cn
--
Administrator
Guest
krbtgt
Machine-1
Admin2
Machine-2
SQL Service
POST{P0W3RV13W_FTW}
sshd
```

# Enumeration With Bloodhound

```Bash
┌──(kali㉿kali)-[~]
└─$ sudo apt install bloodhound  
[sudo] password for kali: 
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  fastjar jarwrapper neo4j
The following NEW packages will be installed:
  bloodhound fastjar jarwrapper neo4j
0 upgraded, 4 newly installed, 0 to remove and 862 not upgraded.
Need to get 183 MB of archives.
After this operation, 402 MB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://kali.download/kali kali-rolling/main amd64 fastjar amd64 2:0.98-7 [80.1 kB]
Get:2 http://kali.download/kali kali-rolling/main amd64 jarwrapper all 0.79 [10.1 kB]
Get:3 http://http.kali.org/kali kali-rolling/main amd64 neo4j all 5.2.0+really4.4.16-0kali1 [113 MB]
Get:4 http://kali.download/kali kali-rolling/main amd64 bloodhound amd64 4.3.1-0kali1 [69.3 MB]                   
Fetched 183 MB in 1min 14s (2,483 kB/s)                                                                           
Selecting previously unselected package fastjar.
(Reading database ... 380760 files and directories currently installed.)
Preparing to unpack .../fastjar_2%3a0.98-7_amd64.deb ...
Unpacking fastjar (2:0.98-7) ...
Selecting previously unselected package jarwrapper.
Preparing to unpack .../jarwrapper_0.79_all.deb ...
Unpacking jarwrapper (0.79) ...
Selecting previously unselected package neo4j.
Preparing to unpack .../neo4j_5.2.0+really4.4.16-0kali1_all.deb ...
Unpacking neo4j (5.2.0+really4.4.16-0kali1) ...
Selecting previously unselected package bloodhound.
Preparing to unpack .../bloodhound_4.3.1-0kali1_amd64.deb ...
Unpacking bloodhound (4.3.1-0kali1) ...
Setting up fastjar (2:0.98-7) ...
Setting up jarwrapper (0.79) ...
Setting up neo4j (5.2.0+really4.4.16-0kali1) ...
Setting up bloodhound (4.3.1-0kali1) ...
Processing triggers for kali-menu (2023.2.3) ...
Processing triggers for man-db (2.11.2-2) ...
```

```Bash
┌──(kali㉿kali)-[~]
└─$ sudo neo4j console         
Directories in use:
home:         /usr/share/neo4j
config:       /usr/share/neo4j/conf
logs:         /etc/neo4j/logs
plugins:      /usr/share/neo4j/plugins
import:       /usr/share/neo4j/import
data:         /etc/neo4j/data
certificates: /usr/share/neo4j/certificates
licenses:     /usr/share/neo4j/licenses
run:          /var/lib/neo4j/run
Starting Neo4j.
2023-08-09 20:52:18.207+0000 INFO  Starting...
2023-08-09 20:52:22.102+0000 INFO  This instance is ServerId{83b1f744} (83b1f744-74cb-4700-9582-2e157a9182b1)
2023-08-09 20:52:27.581+0000 INFO  ======== Neo4j 4.4.16 ========
2023-08-09 20:52:33.137+0000 INFO  Initializing system graph model for component 'security-users' with version -1 and status UNINITIALIZED
2023-08-09 20:52:33.162+0000 INFO  Setting up initial user from defaults: neo4j
2023-08-09 20:52:33.164+0000 INFO  Creating new user 'neo4j' (passwordChangeRequired=true, suspended=false)
2023-08-09 20:52:33.215+0000 INFO  Setting version for 'security-users' to 3
2023-08-09 20:52:33.226+0000 INFO  After initialization of system graph model component 'security-users' have version 3 and status CURRENT
2023-08-09 20:52:33.246+0000 INFO  Performing postInitialization step for component 'security-users' with version 3 and status CURRENT
2023-08-09 20:52:34.071+0000 INFO  Bolt enabled on localhost:7687.
2023-08-09 20:52:37.658+0000 INFO  Remote interface available at http://localhost:7474/
2023-08-09 20:52:37.666+0000 INFO  id: 022113A4A30D5B944885EC9DDE4DAEA16B002CFD277EE3ED01EE3D71D24811E1
2023-08-09 20:52:37.667+0000 INFO  name: system
2023-08-09 20:52:37.669+0000 INFO  creationDate: 2023-08-09T20:52:29.772Z
2023-08-09 20:52:37.670+0000 INFO  Started.
```

```Bash
┌──(kali㉿kali)-[~]
└─$ ssh Administrator@10.10.32.47           
The authenticity of host '10.10.32.47 (10.10.32.47)' can't be established.
ED25519 key fingerprint is SHA256:WGyVsv2zGcSJEHIwp99EmFf5p6Q49BhKyHfmoVOGCAg.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.32.47' (ED25519) to the list of known hosts.
Administrator@10.10.32.47's password:

Microsoft Windows [Version 10.0.17763.737]
(c) 2018 Microsoft Corporation. All rights reserved.

controller\administrator@DOMAIN-CONTROLL C:\Users\Administrator>
```

```Bash
controller\administrator@DOMAIN-CONTROLL C:\Users\Administrator>PowerShell.exe -ep Bypass
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Users\Administrator>  
```

```Bash
controller\administrator@DOMAIN-CONTROLL C:\Users\Administrator>PowerShell.exe -ep Bypass
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Users\Administrator>  
```

```PowerShell
PS C:\Users\Administrator> . .\Downloads\SharpHound.ps1 
```

```PowerShell
PS C:\Users\Administrator> Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip 
---------------------------------------------- 
Initializing SharpHound at 2:01 PM on 8/9/2023
----------------------------------------------

Resolved Collection Methods: Group, Sessions, LoggedOn, Trusts, ACL, ObjectProps, LocalGroups, SPNTargets, Container

[+] Creating Schema map for domain CONTROLLER.LOCAL using path CN=Schema,CN=Configuration,DC=CONTROLLER,DC=LOCAL    
PS C:\Users\Administrator> [+] Cache File not Found: 0 Objects in cache 

[+] Pre-populating Domain Controller SIDS 
Status: 0 objects finished (+0) -- Using 72 MB RAM 
Status: 66 objects finished (+66 66)/s -- Using 81 MB RAM 
Enumeration finished in 00:00:01.2038951                           
Compressing data to C:\Users\Administrator\20230809140141_loot.zip 
You can upload this file directly to the UI                        

SharpHound Enumeration Completed at 2:01 PM on 8/9/2023! Happy Graphing! 
```

```PowerShell
PS C:\Users\Administrator> dir 


    Directory: C:\Users\Administrator


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-r---        5/13/2020   8:01 PM                3D Objects
d-r---        5/13/2020   8:01 PM                Contacts
d-r---        5/13/2020   8:01 PM                Desktop
d-r---        5/14/2020   8:27 PM                Documents
d-r---        10/3/2020   8:33 AM                Downloads
d-r---        5/13/2020   8:01 PM                Favorites
d-r---        5/13/2020   8:01 PM                Links
d-r---        5/13/2020   8:01 PM                Music
d-r---        5/13/2020   8:01 PM                Pictures
d-r---        5/13/2020   8:01 PM                Saved Games
d-r---        5/13/2020   8:01 PM                Searches
d-r---        5/13/2020   8:01 PM                Videos
-a----         8/9/2023   2:01 PM           9527 20230809140141_loot.zip
-a----         8/9/2023   2:01 PM          11709 YmM2MWQ1NzYtYWFhYS00MjM1LThjYmQtYTE4ZDM4ZGFiNTFl.bin
```

```Bash
┌──(kali㉿kali)-[~]
└─$ scp Administrator@10.10.32.47:/Users/Administrator/20230809140141_loot.zip ~/

Administrator@10.10.32.47's password: 
20230809140141_loot.zip                                                           100% 9527    26.4KB/s   00:00
```

```Bash
┌──(kali㉿kali)-[~]
└─$ ls
20230809140141_loot.zip  Desktop    Downloads  Pictures  Videos
armitage-tmp             Documents  Music      Public    Scanning.sh
```

```Bash
┌──(kali㉿kali)-[~]
└─$ unzip 20230809140141_loot.zip 
Archive:  20230809140141_loot.zip
  inflating: 20230809140141_groups.json  
  inflating: 20230809140141_users.json  
  inflating: 20230809140141_domains.json  
  inflating: 20230809140141_gpos.json  
  inflating: 20230809140141_ous.json  
  inflating: 20230809140141_computers.json  
```

```Bash
┌──(kali㉿kali)-[~]
└─$ ls
20230809140141_computers.json  20230809140141_loot.zip    Desktop    Pictures              
20230809140141_domains.json    20230809140141_ous.json    Documents  Public                
20230809140141_gpos.json       20230809140141_users.json  Downloads  Videos
20230809140141_groups.json     armitage-tmp               Music      
```

Make sure you resetted your password [here](http://localhost:7474 )

```Bash
┌──(kali㉿kali)-[~]
└─$ bloodhound
```
